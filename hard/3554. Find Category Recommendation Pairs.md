# 3554. Find Category Recommendation Pairs

**Data:** 24/01/2026  
**Dificuldade:** Hard  
**Tópicos:** SQL, CTE, Self Join, GROUP BY, COUNT, Recommendation  
**Link:** https://leetcode.com/problems/find-category-recommendation-pairs/description/?envType=problem-list-v2&envId=vszzv79m  

## Descrição
O objetivo é identificar pares de categorias de produtos que são frequentemente comprados pelos mesmos usuários.  
Esses pares podem ser usados como recomendações, pois indicam categorias que têm alta correlação de compra.

Para isso:
- Cada usuário é associado às categorias distintas dos produtos que comprou.
- Em seguida, criamos combinações de pares de categorias para o mesmo usuário.
- Por fim, contamos quantos usuários aparecem em cada par e mantemos apenas aqueles com pelo menos 3 clientes em comum.

---

## Solução (SQL Server)
```sql
WITH qwe AS (
    SELECT DISTINCT 
        pp.user_id, 
        pi.category
    FROM productpurchases pp
    JOIN productinfo pi 
      ON pp.product_id = pi.product_id
)

SELECT
    a.category AS category1,
    b.category AS category2,
    COUNT(DISTINCT a.user_id) AS customer_count
FROM qwe a
JOIN qwe b
    ON a.user_id = b.user_id
   AND a.category < b.category
GROUP BY a.category, b.category
HAVING COUNT(DISTINCT a.user_id) >= 3
ORDER BY customer_count DESC, category1 ASC, category2 ASC;
