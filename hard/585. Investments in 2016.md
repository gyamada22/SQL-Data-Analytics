# 585. Investments in 2016

**Data:** 03/01/2026  
**Dificuldade:** Hard  
**Tópicos:** SQL, Window Functions, CTE  
**Link:** [Investments in 2016 - LeetCode](https://leetcode.com/problems/investments-in-2016/description/?source=submission-ac)

## Descrição
Escreva uma solução para calcular o **valor total de investimentos em 2016 (`tiv_2016`)**, considerando apenas as apólices válidas.

Uma apólice é válida se:
- Compartilha o mesmo valor de `tiv_2015` com pelo menos outra apólice
- Possui uma **localização única**, definida pelo par (`lat`, `lon`)

## Solução (SQL Server)

```sql
WITH policy_stats AS (
    SELECT 
        tiv_2016,
        COUNT(*) OVER (PARTITION BY tiv_2015) AS tiv_2015_count,
        COUNT(*) OVER (PARTITION BY lat, lon) AS location_count
    FROM insurance
)
SELECT 
    CAST(SUM(tiv_2016) AS DECIMAL(18,2)) AS tiv_2016
FROM policy_stats
WHERE tiv_2015_count > 1
  AND location_count = 1;
