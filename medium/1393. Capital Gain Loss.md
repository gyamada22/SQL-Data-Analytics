# 1393. Capital Gain Loss

**Data:** 18/01/2026  
**Dificuldade:** Medium  
**Tópicos:** SQL, CTE, GROUP BY, Aggregation  
**Link:** [Capital Gain/Loss - LeetCode](https://leetcode.com/problems/capital-gainloss/description/)

## Descrição
Para cada ação (`stock_name`), calcule o **ganho ou perda de capital**, definido como:
total_sell - total_buy

Ou seja:
- Somar todos os preços das operações de **Buy**
- Somar todos os preços das operações de **Sell**
- Subtrair o total de compras do total de vendas

## Solução (SQL)

```sql
WITH buy_totals AS (
    SELECT 
        stock_name,
        SUM(price) AS total_buy
    FROM stocks
    WHERE operation = 'Buy'
    GROUP BY stock_name
),
sell_totals AS (
    SELECT 
        stock_name,
        SUM(price) AS total_sell
    FROM stocks
    WHERE operation = 'Sell'
    GROUP BY stock_name
)
SELECT  
    b.stock_name,
    s.total_sell - b.total_buy AS capital_gain_loss
FROM buy_totals b
JOIN sell_totals s
    ON b.stock_name = s.stock_name;

