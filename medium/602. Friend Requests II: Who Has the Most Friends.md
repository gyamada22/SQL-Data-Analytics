# 602. Friend Requests II: Who Has the Most Friends

**Data:** 02/01/2026  
**Dificuldade:** Medium  
**Tópicos:** SQL, CTE, UNION ALL, GROUP BY  
**Link:** [Friend Requests II: Who Has the Most Friends - LeetCode](https://leetcode.com/problems/friend-requests-ii-who-has-the-most-friends/description/?envType=study-plan-v2&envId=top-sql-50)

## Descrição
Escreva uma solução para encontrar a pessoa que possui o **maior número de amigos**.  
Cada solicitação aceita representa uma amizade **bidirecional**, ou seja, ambos os usuários ganham um amigo.

## Solução (SQL Server)

```sql
WITH friendships AS (
    SELECT requester_id AS user_id, accepter_id AS friend_id
    FROM requestaccepted
    UNION ALL
    SELECT accepter_id AS user_id, requester_id AS friend_id
    FROM requestaccepted
)
SELECT TOP 1
    user_id AS id,
    COUNT(friend_id) AS num
FROM friendships
GROUP BY user_id
ORDER BY COUNT(friend_id) DESC;
